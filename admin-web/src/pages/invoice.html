<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>H√≥a ƒë∆°n & Thanh to√°n - Admin</title>
    <script src="../services/auth-check.js"></script>
    <link rel="stylesheet" href="../assets/css/MenuManage.css">
</head>

<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="brand"><span>üçΩÔ∏è</span> V∆∞·ªùn Qu√™ Admin</a>
            </div>
            <ul class="sidebar-menu">
                <li><a href="../index.html"><span class="icon">üè†</span> T·ªïng quan</a></li>
                <li><a href="menu-manage.html"><span class="icon">üìã</span> Qu·∫£n l√Ω Menu</a></li>
                <li><a href="category-manage.html"><span class="icon">üìÇ</span> Qu·∫£n l√Ω Danh m·ª•c</a></li>
                <li><a href="staff-manage.html"><span class="icon">üë•</span> Qu·∫£n l√Ω Nh√¢n vi√™n</a></li>
                <li><a href="invoice.html" class="active"><span class="icon">üßæ</span> H√≥a ƒë∆°n & Thanh to√°n</a></li>
                <li><a href="statistic.html"><span class="icon">üìä</span> B√°o c√°o Th·ªëng k√™</a></li>
            </ul>
            <div class="sidebar-footer">&copy; 2026 V∆∞·ªùn Qu√™ Restaurant</div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1 class="page-title">H√≥a ƒë∆°n & Thanh to√°n</h1>
                <div class="user-profile"><span class="user-name">Qu·∫£n tr·ªã vi√™n</span>
                    <div class="avatar">A</div>
                </div>
            </header>

            <div class="content-scrollable">
                <div class="data-container">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0;">Danh s√°ch h√≥a ƒë∆°n</h2>
                        <button class="btn btn-primary" onclick="fetchInvoices()"> L√†m m·ªõi</button>
                    </div>

                    <table id="invoice-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>B√†n</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>Thanh to√°n</th>
                                <th>T·ªïng ti·ªÅn</th>
                                <th>Ng√†y t·∫°o</th>
                                <th style="text-align: right;">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="invoice-detail"
                        style="display:none; margin-top: 32px; padding: 24px; background: var(--color-bg-secondary); border-radius: 12px; border: 1px solid var(--color-neutral-200);">
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../services/admin-api.js"></script>
    <script>
        function fetchInvoices() {
            adminApi.getInvoices().then(data => {
                const tbody = document.querySelector('#invoice-table tbody');
                tbody.innerHTML = '';
                data.forEach(inv => {
                    const paymentMethod = inv.type_payment === 'CAST' ? 'Ti·ªÅn m·∫∑t' : (inv.type_payment === 'BANK' ? 'Chuy·ªÉn kho·∫£n' : inv.type_payment);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${inv.id}</td>
                <td>${inv.table_number || ''}</td>
                <td>${inv.customer_name || 'Kh√°ch v√£ng lai'}</td>
                <td><span class="status-active" style="background:${inv.type_payment === 'CAST' ? '#dcfce7' : '#dbeafe'}; color:${inv.type_payment === 'CAST' ? '#166534' : '#1e40af'}">${paymentMethod}</span></td>
                <td style="font-weight:600;">${new Intl.NumberFormat('vi-VN').format(inv.total_amount)} ‚Ç´</td>
                <td>${inv.created_at}</td>
                <td style="text-align: right;">
                    <button class="btn btn-secondary" onclick="viewInvoice(${inv.id})">Chi ti·∫øt</button>
                </td>`;
                    tbody.appendChild(tr);
                });
            });
        }
        function viewInvoice(id) {
            adminApi.getInvoiceDetail(id).then(inv => {
                const paymentMethod = inv.type_payment === 'CAST' ? 'Ti·ªÅn m·∫∑t' : (inv.type_payment === 'BANK' ? 'Chuy·ªÉn kho·∫£n' : inv.type_payment);
                let html = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <h2 style="margin: 0;">Chi ti·∫øt h√≥a ƒë∆°n #${inv.id}</h2>
                <button class="btn" onclick="document.getElementById('invoice-detail').style.display='none'">ƒê√≥ng</button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; background: white; padding: 20px; border-radius: 8px;">
                <div>
                    <h4 style="margin-top:0; color:#666;">Th√¥ng tin ƒë∆°n h√†ng</h4>
                    <p><strong>B√†n:</strong> ${inv.table_number || 'N/A'}</p>
                    <p><strong>Kh√°ch h√†ng:</strong> ${inv.customer_name || 'Kh√°ch v√£ng lai'}</p>
                    <p><strong>Nh√¢n vi√™n:</strong> ${inv.staff_name || 'N/A'}</p>
                    <p><strong>Ghi ch√∫:</strong> ${inv.note || 'Kh√¥ng c√≥'}</p>
                </div>
                <div>
                    <h4 style="margin-top:0; color:#666;">Th√¥ng tin thanh to√°n</h4>
                    <p><strong>Ng√†y t·∫°o:</strong> ${inv.created_at}</p>
                    <p><strong>Ph∆∞∆°ng th·ª©c:</strong> ${paymentMethod}</p>
                    <p><strong>T·ªïng ti·ªÅn:</strong> <span style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary-600);">${new Intl.NumberFormat('vi-VN').format(inv.total_amount)} ‚Ç´</span></p>
                </div>
            </div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>M√≥n ƒÉn</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>ƒê∆°n gi√°</th>
                        <th style="text-align: right;">Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    ${inv.items.map(i => `
                        <tr>
                            <td>${i.menu_item_name}</td>
                            <td>${i.quantity}</td>
                            <td>${new Intl.NumberFormat('vi-VN').format(i.price)} ‚Ç´</td>
                            <td style="text-align: right;">${new Intl.NumberFormat('vi-VN').format(i.price * i.quantity)} ‚Ç´</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
                const detailDiv = document.getElementById('invoice-detail');
                detailDiv.innerHTML = html;
                detailDiv.style.display = 'block';
                detailDiv.scrollIntoView({ behavior: 'smooth' });
            });
        }
        fetchInvoices();
    </script>
</body>

</html>