<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>HÃ³a Ä‘Æ¡n & Thanh toÃ¡n - Admin</title>
    <script src="../services/auth-check.js"></script>
    <link rel="stylesheet" href="../assets/css/MenuManage.css">
</head>

<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="brand"><span>ğŸ½ï¸</span> VÆ°á»n QuÃª Admin</a>
            </div>
            <ul class="sidebar-menu">
                <li><a href="../index.html"><span class="icon">ğŸ </span> Tá»•ng quan</a></li>
                <li><a href="menu-manage.html"><span class="icon">ğŸ“‹</span> Quáº£n lÃ½ Menu</a></li>
                <li><a href="category-manage.html"><span class="icon">ğŸ“‚</span> Quáº£n lÃ½ Danh má»¥c</a></li>
                <li><a href="staff-manage.html"><span class="icon">ğŸ‘¥</span> Quáº£n lÃ½ NhÃ¢n viÃªn</a></li>
                <li><a href="invoice.html" class="active"><span class="icon">ğŸ§¾</span> HÃ³a Ä‘Æ¡n & Thanh toÃ¡n</a></li>
                <li><a href="statistic.html"><span class="icon">ğŸ“Š</span> BÃ¡o cÃ¡o Thá»‘ng kÃª</a></li>
            </ul>
            <div class="sidebar-footer">&copy; 2026 VÆ°á»n QuÃª Restaurant</div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1 class="page-title">HÃ³a Ä‘Æ¡n & Thanh toÃ¡n</h1>
                <div class="user-profile"><span class="user-name">Quáº£n trá»‹ viÃªn</span>
                    <div class="avatar">A</div>
                </div>
            </header>

            <div class="content-scrollable">
                <div class="data-container">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0;">Danh sÃ¡ch hÃ³a Ä‘Æ¡n</h2>
                        <button class="btn btn-primary" onclick="fetchInvoices()">ğŸ”„ LÃ m má»›i</button>
                    </div>

                    <table id="invoice-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>BÃ n</th>
                                <th>Tá»•ng tiá»n</th>
                                <th>NgÃ y táº¡o</th>
                                <th>Tráº¡ng thÃ¡i</th>
                                <th style="text-align: right;">HÃ nh Ä‘á»™ng</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="invoice-detail"
                        style="display:none; margin-top: 32px; padding: 24px; background: var(--color-bg-secondary); border-radius: 12px; border: 1px solid var(--color-neutral-200);">
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../services/admin-api.js"></script>
    <script>
        function fetchInvoices() {
            adminApi.getInvoices().then(data => {
                const tbody = document.querySelector('#invoice-table tbody');
                tbody.innerHTML = '';
                data.forEach(inv => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${inv.id}</td>
                <td>${inv.table_number || ''}</td>
                <td>${new Intl.NumberFormat('vi-VN').format(inv.total_amount)} â‚«</td>
                <td>${inv.created_at}</td>
                <td><span class="status-active">${inv.status}</span></td>
                <td style="text-align: right;">
                    <button class="btn btn-secondary" onclick="viewInvoice(${inv.id})">Chi tiáº¿t</button>
                </td>`;
                    tbody.appendChild(tr);
                });
            });
        }
        function viewInvoice(id) {
            adminApi.getInvoiceDetail(id).then(inv => {
                let html = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <h2 style="margin: 0;">Chi tiáº¿t hÃ³a Ä‘Æ¡n #${inv.id}</h2>
                <button class="btn" onclick="document.getElementById('invoice-detail').style.display='none'">ÄÃ³ng</button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                <div>
                    <p><strong>BÃ n:</strong> ${inv.table_number || 'N/A'}</p>
                    <p><strong>NgÃ y táº¡o:</strong> ${inv.created_at}</p>
                </div>
                <div>
                    <p><strong>Tráº¡ng thÃ¡i:</strong> ${inv.status}</p>
                    <p><strong>Tá»•ng tiá»n:</strong> <span style="font-size: 1.25rem; font-weight: 700; color: var(--color-primary-600);">${new Intl.NumberFormat('vi-VN').format(inv.total_amount)} â‚«</span></p>
                </div>
            </div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>MÃ³n Äƒn</th>
                        <th>Sá»‘ lÆ°á»£ng</th>
                        <th>ÄÆ¡n giÃ¡</th>
                        <th style="text-align: right;">ThÃ nh tiá»n</th>
                    </tr>
                </thead>
                <tbody>
                    ${inv.items.map(i => `
                        <tr>
                            <td>${i.menu_item_name}</td>
                            <td>${i.quantity}</td>
                            <td>${new Intl.NumberFormat('vi-VN').format(i.price)} â‚«</td>
                            <td style="text-align: right;">${new Intl.NumberFormat('vi-VN').format(i.price * i.quantity)} â‚«</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
                const detailDiv = document.getElementById('invoice-detail');
                detailDiv.innerHTML = html;
                detailDiv.style.display = 'block';
                detailDiv.scrollIntoView({ behavior: 'smooth' });
            });
        }
        fetchInvoices();
    </script>
</body>

</html>