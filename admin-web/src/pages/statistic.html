<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thá»‘ng kÃª Ä‘Æ¡n hÃ ng - Admin</title>
    <link rel="stylesheet" href="../assets/css/MenuManage.css">
</head>
<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="brand"><span>ğŸ½ï¸</span> VÆ°á»n QuÃª Admin</a>
            </div>
            <ul class="sidebar-menu">
                <li><a href="../index.html"><span class="icon">ğŸ </span> Tá»•ng quan</a></li>
                <li><a href="menu-manage.html"><span class="icon">ğŸ“‹</span> Quáº£n lÃ½ Menu</a></li>
                <li><a href="category-manage.html"><span class="icon">ğŸ“‚</span> Quáº£n lÃ½ Danh má»¥c</a></li>
                <li><a href="staff-manage.html"><span class="icon">ğŸ‘¥</span> Quáº£n lÃ½ NhÃ¢n viÃªn</a></li>
                <li><a href="invoice.html"><span class="icon">ğŸ§¾</span> HÃ³a Ä‘Æ¡n & Thanh toÃ¡n</a></li>
                <li><a href="statistic.html" class="active"><span class="icon">ğŸ“Š</span> BÃ¡o cÃ¡o Thá»‘ng kÃª</a></li>
            </ul>
            <div class="sidebar-footer">&copy; 2026 VÆ°á»n QuÃª Restaurant</div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1 class="page-title">BÃ¡o cÃ¡o Thá»‘ng kÃª</h1>
                <div class="user-profile"><span class="user-name">Quáº£n trá»‹ viÃªn</span><div class="avatar">A</div></div>
            </header>

            <div class="content-scrollable">
                <div class="data-container">
                    <h2 style="margin-bottom: 24px;">Lá»c theo thá»i gian</h2>
                    <div class="stat-block" style="display: flex; gap: 20px; align-items: flex-end; margin-bottom: 30px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Tá»« ngÃ y</label>
                            <input type="date" id="from">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Äáº¿n ngÃ y</label>
                            <input type="date" id="to">
                        </div>
                        <button class="btn btn-primary" onclick="fetchStatistic()">Xem bÃ¡o cÃ¡o</button>
                    </div>
                    
                    <div id="stat-result" style="margin-top: 40px;">
                        <!-- Results populate here -->
                    </div>
                </div>
            </div>
        </main>
    </div>
<script>
function fetchStatistic() {
    const from = document.getElementById('from').value;
    const to = document.getElementById('to').value;
    let url = `/VuonQueRestaurantOrder/backend/src/public/index.php/api/admin/statistics`;
    const params = [];
    if (from) params.push(`from=${from}`);
    if (to) params.push(`to=${to}`);
    if (params.length) url += '?' + params.join('&');
    fetch(url).then(r=>r.json()).then(r => {
        if (!r.success) return alert(r.message);
        const d = r.data;
        let html = `<b>Khoáº£ng thá»i gian:</b> ${d.range.from} - ${d.range.to}<br>`;
        html += `<b>Tá»•ng Ä‘Æ¡n:</b> ${d.orders.total} <br>`;
        html += `<b>ÄÆ¡n theo tráº¡ng thÃ¡i:</b> ` + Object.entries(d.orders.by_status).map(([k,v])=>`${k}: ${v}`).join(', ') + '<br>';
        html += `<b>Tá»•ng hÃ³a Ä‘Æ¡n:</b> ${d.invoices.total}, ÄÃ£ thanh toÃ¡n: ${d.invoices.paid}, ChÆ°a thanh toÃ¡n: ${d.invoices.pending}<br>`;
        html += `<b>Doanh thu Ä‘Ã£ thanh toÃ¡n:</b> ${d.revenue.paid_total.toLocaleString('vi-VN')} â‚«<br>`;
        html += `<b>Top mÃ³n bÃ¡n cháº¡y:</b><br><table><tr><th>TÃªn mÃ³n</th><th>Sá»‘ lÆ°á»£ng</th><th>Doanh thu</th></tr>`;
        d.top_items.forEach(item => {
            html += `<tr><td>${item.menu_item_name}</td><td>${item.total_quantity}</td><td>${parseInt(item.total_amount).toLocaleString('vi-VN')} â‚«</td></tr>`;
        });
        html += '</table>';
        document.getElementById('stat-result').innerHTML = html;
    });
}
fetchStatistic();
</script>
</body>
</html>
